<!DOCTYPE html>
<html>


  <head>

    <script>

      function postRequest(url, data, callback) {

        const formData = new FormData()
        for (key in data) {
          formData.append(key, data[key])
        }

        console.log(formData,  data)

        const http = new XMLHttpRequest();
        http.open('POST', url, true)
        http.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded' )
        http.onload = callback
        http.send(formData)

      }

      document.addEventListener('DOMContentLoaded', () => {

        const btn = document.getElementById('paste-button')

        btn.addEventListener('click', async () => {

           try {
            const clipboardItems = await navigator.clipboard.read();
            for (const clipboardItem of clipboardItems) {
              const imageTypes = clipboardItem.types.find(type => type.startsWith('image/'))
              const blob = await clipboardItem.getType(imageTypes);
              // const arrayBuffer = await blob.arrayBuffer()

              // console.log(arrayBuffer)
              // postRequest('/search', { arrayBuffer }, () => {
              //   console.log('completed')
              // })

              fetch('/search', {
                method: 'POST',
                body: blob
              })
              .then(response => console.log(response))

            }
          } catch (err) {
            console.error(err.name, err.message);
          }
        })


      })

      
    </script>
  </head>

  <body>

    <button id="paste-button">Paste</button>


  </body>
</html>