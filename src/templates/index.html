<!DOCTYPE html>
<html>

<head>
  {% block head %}
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  {% block styles %}
  <!-- Bootstrap CSS -->
  {{ bootstrap.load_css() }}
  {% endblock %}
  
  <title>Search product with image</title>
  {% endblock %}
  <script>

    document.addEventListener('DOMContentLoaded', () => {

      // console.log(`copied '${value}' to clipboard`);

      const btn = document.getElementById('paste-button')

      btn.addEventListener('click', async () => {

        try {
          const clipboardItems = await navigator.clipboard.read();
          for (const clipboardItem of clipboardItems) {
            const imageTypes = clipboardItem.types.find(type => type.startsWith('image/'))
            const blob = await clipboardItem.getType(imageTypes);

            fetch('/api/search', {
              method: 'POST',
              body: blob
            })
              .then(response => console.log(response))

          }
        } catch (err) {
          console.error(err.name, err.message);
        }
      })

      const previewIMG = document.getElementById('search-image-preview')

      document.onpaste = async function (event) {

        console.log(event)

        try {
          // const clipboardItems = await navigator.clipboard.read();
          for (const clipboardItem of event.clipboardData.items) {


            console.log(clipboardItem)
            if (clipboardItem.type.indexOf('image/') === 0) {
              previewIMG.src = URL.createObjectURL(clipboardItem.getAsFile());

            }

            event.preventDefault()

          }
        } catch (err) {
          console.error(err.name, err.message);
        }

      }


    })


  </script>
</head>

<body>

  <div class="container">

    <div>
      <button type="button" id="paste-button" class="btn btn-primary">Search</button>
      <img id="search-image-preview" width="200" height="200" />
    </div>

  </div>

  <div>
    <a href="/product"> Add product
  </div>





</body>

</html>