<!DOCTYPE html>
<html>


<head>

  <script>

    document.addEventListener('DOMContentLoaded', () => {

      // console.log(`copied '${value}' to clipboard`);

      const btn = document.getElementById('paste-button')

      btn.addEventListener('click', async () => {

        try {
          const clipboardItems = await navigator.clipboard.read();
          for (const clipboardItem of clipboardItems) {
            const imageTypes = clipboardItem.types.find(type => type.startsWith('image/'))
            const blob = await clipboardItem.getType(imageTypes);

            fetch('/search', {
              method: 'POST',
              body: blob
            })
              .then(response => console.log(response))

          }
        } catch (err) {
          console.error(err.name, err.message);
        }
      })

      document.getElementById('update-button').addEventListener('click', () => {
        fetch('/generate', {
          method: 'POST'
        })
          .then(response => {

            document.getElementById('update-status').innerText = 'Update Completed'
            
          })
      })

      const previewIMG = document.getElementById('search-image-preview')

      document.onpaste = async function (event) {

        console.log(event)

        try {
          // const clipboardItems = await navigator.clipboard.read();
          for (const clipboardItem of event.clipboardData.items) {


            console.log(clipboardItem)
            if (clipboardItem.type.indexOf('image/') === 0) {
              previewIMG.src = URL.createObjectURL(clipboardItem.getAsFile());

            }

            event.preventDefault()

          }
        } catch (err) {
          console.error(err.name, err.message);
        }

      }


    })


  </script>
</head>

<body>

  <div>
    <div>
    
      <button id="update-button">Update data</button>
      <div id="update-status"></div>
    </div>


    <div>      
      <button id="paste-button">Search</button>
      <img id="search-image-preview" width="200" height="200" />
    </div>

  </div>





</body>

</html>